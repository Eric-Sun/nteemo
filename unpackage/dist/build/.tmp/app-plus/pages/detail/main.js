(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detail/main"],{"3f63":function(t,e,n){"use strict";var i=n("b130"),o=n.n(i);o.a},"85a5":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,i=(t._self._c,n("524f")),o=n("9212"),a=n("f15f"),s=n("524f"),r=n("3e27"),u=n("dd67"),c=n("f4d5");t.$mp.data=Object.assign({},{$root:{m0:i,m1:o,m2:a,m3:s,m4:r,m5:u,m6:c}})},o=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o})},"91ce":function(t,e,n){"use strict";n.r(e);var i=n("85a5"),o=n("b822");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("3f63");var s=n("2877"),r=Object(s["a"])(o["default"],i["a"],i["b"],!1,null,"dfefc526",null);e["default"]=r.exports},b130:function(t,e,n){},b822:function(t,e,n){"use strict";n.r(e);var i=n("f4e0"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},f4e0:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n("faf3"),o=n("fb86"),a=n("0d80");function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){r(t,e,n[e])})}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){return n.e("components/login").then(n.bind(null,"6a4f"))},c=function(){return Promise.all([n.e("common/vendor"),n.e("components/sendReply")]).then(n.bind(null,"da35"))},l=function(){return Promise.all([n.e("common/vendor"),n.e("components/loginTips")]).then(n.bind(null,"32a8"))},d=function(){return(0,o.debounce)(function(t){this.cursor=t.target.scrollTop})},p={components:{sendReply:c,login:u,loginTips:l},onUnload:function(){this.$http.get("".concat(i.api),{act:"post.updateCursor",postId:this.id,pageNum:this.pageNum,t:this.t,cursor:this.cursor}),this.detailData={},this.currentReplies=[]},mounted:function(){var t=this;setTimeout(function(){t.cursor=t.cursorTmp},1e3)},computed:{culculatePageNum:function(){return Math.floor(this.level1ReplySize/i.reply_size_per_page)+1},formatCreateAt:function(){return(0,o.passTime)(this.detailData.createtime)},formatReplies:function(){return this.currentReplies.map(function(t){return s({},t,{createtime:(0,o.passTime)(t.createtime)})})},culBuildingIndex:function(){return function(t){}}},onShareAppMessage:function(){return{title:this.detailData.title,path:"/pages/detail/main?postId="+this.id+"&share=1"}},methods:{backPage:function(){0!=this.pageNum&&(1==this.pageNum?(this.pageNum=this.pageNum-1,this.includePostContent=1,t.showLoading({title:"加载中"}),this.getReplyData(this.pageNum)):(this.pageNum=this.pageNum-1,this.getReplyData(this.pageNum)))},closeModalEvent:function(){this.loginVisible=!1,this.t=t.getStorageSync("t"),this.getPostData(),this.getReplyData(-1)},goPage:function(){this.pageNum!=this.culculatePageNum&&(0==this.pageNum&&(this.includePostContent=0),this.pageNum++,this.getReplyData(this.pageNum))},doOrUndoCollect:function(){1==this.detailData.isCollection?this.$http({act:"collection.post.delete",t:this.t,postId:this.id},function(e){30003==e.data.code?t.showToast({title:"已经取消收藏了",icon:"none",duration:2e3}):null!=e.data.code?t.showToast({title:"服务正在失去联系，请稍后",icon:"none",duration:2e3}):(t.showToast({title:"取消收藏成功",icon:"none",duration:2e3}),this.detailData.isCollection=0)}):this.$http({act:"collection.post.add",t:this.t,postId:this.id},function(e){30002==e.data.code?t.showToast({title:"已经收藏了",icon:"none",duration:2e3}):null!=e.data.code?t.showToast({title:"服务正在失去联系，请稍后",icon:"none",duration:2e3}):(t.showToast({title:"收藏成功",icon:"none",duration:2e3}),this.detailData.isCollection=1)})},previewImg:function(t){for(var e=[],n=0;n<this.detailData.imgList.length;n++)e.push(this.detailData.imgList[n].url);wx.previewImage({current:this.detailData.imgList[t].url,urls:e})},navigateToReply:function(e){var n=e.currentTarget.dataset.replyid,i=e.currentTarget.dataset.postid,o=e.currentTarget.dataset.anonymous,a=this.detailData.userId;t.navigateTo({url:"../reply/main?replyId=".concat(n,"&postId=").concat(i,"&anonymous=").concat(o,"&postUserId=").concat(a)})},onScroll:d(),getPostData:function(){var e=this;t.showLoading({title:"加载中"}),this.$http({act:"post.detail",postId:this.id,t:this.t},function(n){e.detailData=n.data,e.level1ReplySize=n.data.level1ReplySize,t.hideLoading()})},getReplyData:function(e){t.showLoading({title:"加载中"});var n=this;this.$http({act:this.requestAction,pageNum:e,postId:this.id,t:this.t},function(i){n.pageNum=e,n.currentReplies=i.data.data,n.pageNum=i.data.cursorInfo.pageNum,0!=n.pageNum&&(n.includePostContent=0),-1==e?n.cursorTmp=i.data.cursorInfo.cursor:n.cursor=0,t.hideLoading()})},goBottom:function(){this.top=1e3*this.currentReplies.length},backHome:function(){t.reLaunch({url:"/pages/index/main"})},showReplyModal:function(e){var n=this;this.t=t.getStorageSync("t"),(0,a.checkT)(this.t,function(){n.loginVisible=!0},function(){var i=t.getStorageSync("userId"),o=e.currentTarget.dataset.username,a=e.currentTarget.dataset.replyid,s=n.detailData.anonymous;n.content=o?"@".concat(o,":"):"",i==n.detailData.userId&&(n.isPostUserId=!0),n.postAnonymous=s,n.replyId=a,n.replyUserName=o,n.sendVisible=!0})},replySuccess:function(){this.closeModal(),t.showToast({title:"评论成功",icon:"none",duration:1500}),this.getReplyData(this.pageNum)},closeModal:function(){this.sendVisible=!1}},onLoad:function(){this.id=this.$root.$mp.query.postId,1==this.$root.$mp.query.share&&(this.isShare=1)},onShow:function(){this.reply_size_per_page=i.reply_size_per_page,this.includePostContent=1;var e=this;this.t=t.getStorageSync("t"),(0,a.checkT)(this.t,function(){t.setStorageSync("t",i.no_token_value),e.t=0,e.getPostData(),e.getReplyData(-1)},function(){e.t=t.getStorageSync("t"),e.getPostData(),e.getReplyData(-1)})},onReady:function(){},data:function(){return{detailData:{},remainReplies:[],currentReplies:[],content:"",sendVisible:!1,id:"",replyId:"",timer:null,replyUserName:"",isPostUserId:!1,postAnonymous:0,bottom:0,pageNum:0,replySearchType:0,requestAction:"reply.list",loginVisible:!1,isShare:0,t:0,level1ReplySize:0,includePostContent:1,cursor:-1,reply_size_per_page:0,cursorTmp:0}}};e.default=p}).call(this,n("6e42")["default"])}},[["4372","common/runtime","common/vendor"]]]);